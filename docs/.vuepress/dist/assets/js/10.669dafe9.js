(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{371:function(t,e,s){"use strict";s.r(e);var a=s(40),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"service-providers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#service-providers"}},[t._v("#")]),t._v(" Service Providers")]),t._v(" "),s("h2",{attrs:{id:"introduction"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[t._v("#")]),t._v(" Introduction")]),t._v(" "),s("p",[t._v("Service providers are the central place of all Confetti application bootstrapping. Your own application, as well as all of Confetti's core services are bootstrapped via service providers.")]),t._v(" "),s("p",[t._v("Service providers are loaded once (so before requests takes place). And can therefore lead to a performance profit.")]),t._v(" "),s("p",[t._v('But, what do we mean by "bootstrapped"? In general, we mean '),s("strong",[t._v("registering")]),t._v(" things, including registering service container bindings, event listeners, and even routes. Service providers are the central place to configure your application.")]),t._v(" "),s("p",[t._v("If you open the "),s("code",[t._v("app/providers/provider.go")]),t._v(" file included with Confetti, you will see a "),s("code",[t._v("Providers")]),t._v(" struct. These are all the service providers that will be loaded for your application.")]),t._v(" "),s("p",[t._v("In this overview you will learn how to write your own service providers and register them with your Confetti application.")]),t._v(" "),s("h2",{attrs:{id:"writing-service-providers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#writing-service-providers"}},[t._v("#")]),t._v(" Writing Service Providers")]),t._v(" "),s("p",[t._v("All service providers implements the "),s("code",[t._v("inter.RegisterServiceProvider")]),t._v(" or "),s("code",[t._v("inter.BootServiceProvider")]),t._v(" interface. The service providers contain a "),s("code",[t._v("Register")]),t._v(" and/or a "),s("code",[t._v("Boot")]),t._v(" method. Within the "),s("code",[t._v("Register")]),t._v(" method, you should "),s("strong",[t._v("only bind things into the "),s("a",{attrs:{href:"container"}},[t._v("service container")])]),t._v(". You should never attempt to register any event listeners, routes, or any other piece of functionality within the "),s("code",[t._v("Register")]),t._v(" method. You can have a service provider with a register and a boot method. Then you have to add this service to the RegisterProviders slice, and the BootProviders slice.")]),t._v(" "),s("h3",{attrs:{id:"the-register-method"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#the-register-method"}},[t._v("#")]),t._v(" The Register Method")]),t._v(" "),s("p",[t._v("As mentioned previously, within the "),s("code",[t._v("Register")]),t._v(" method, you should only bind things into the "),s("a",{attrs:{href:"container"}},[t._v("service container")]),t._v(". You should never attempt to register any event listeners, routes, or any other piece of functionality within the "),s("code",[t._v("Register")]),t._v(" method. Otherwise, you may accidentally use a service that is provided by a service provider which has not loaded yet.")]),t._v(" "),s("p",[t._v("Let's take a look at a basic service provider. Within any of your service provider methods, you always have access to the "),s("code",[t._v("inter.Container")]),t._v(" property which provides access to the service container:")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" providers\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/confetti-framework/foundation"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/riak/riak"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" RiakServiceProvider "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Register any application services.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r RiakServiceProvider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Register")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("container inter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Container"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" inter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Container "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Container"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Singleton")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("database"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Connection"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" riak"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewConnection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" app\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("This service provider only defines a "),s("code",[t._v("Register")]),t._v(" method, and uses that method to define an implementation of "),s("code",[t._v("riak")]),t._v(" in the service container. If you don't understand how the service container works, check out "),s("a",{attrs:{href:"container"}},[t._v("its documentation")]),t._v(".")]),t._v(" "),s("h3",{attrs:{id:"the-boot-method"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#the-boot-method"}},[t._v("#")]),t._v(" The Boot Method")]),t._v(" "),s("p",[t._v("The "),s("code",[t._v("Boot")]),t._v(" method is called after all other service providers have been registered, meaning you have access to all other\nservices that have been registered by the framework:")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" DataDog "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("d DataDog"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Boot")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("container inter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Container"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" inter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Container "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" statsd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("New")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:8125"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("panic")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" container\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h4",{attrs:{id:"boot-method-dependency-injection"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#boot-method-dependency-injection"}},[t._v("#")]),t._v(" Boot Method Dependency Injection")]),t._v(" "),s("p",[t._v("You may use Container for your dependencies in your service provider's "),s("code",[t._v("Boot")]),t._v(" method. The "),s("a",{attrs:{href:"container"}},[t._v("service container")]),t._v(" will automatically inject any dependencies you need:")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r ComposerServiceProvider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Boot")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("container inter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Container"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" inter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Container "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    eventPusher "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Make")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"EventPusher"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("contract"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EventPusher"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" app\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"registering-providers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#registering-providers"}},[t._v("#")]),t._v(" Registering Providers")]),t._v(" "),s("p",[t._v("All service providers are registered in the "),s("code",[t._v("app/providers/provider.go")]),t._v(" file. This file contains a "),s("code",[t._v("Providers")]),t._v(" struct where you can list the struct names of your service providers. By default, a set of Confetti core service providers are listed in this struct. These providers bootstrap the core Confetti components, such as the mailer, queue, cache, and others.")]),t._v(" "),s("p",[t._v("To register your provider, add it to the slices:")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[t._v("RegisterProviders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("decorator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RegisterServiceProvider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    providers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AppServiceProvider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    providers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ComposerServiceProvider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\nBootProviders"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("decorator"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BootServiceProvider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    providers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AppServiceProvider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    providers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RouteServiceProvider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    providers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ComposerServiceProvider"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),s("p",[t._v("If you have a service provider with a register and a boot method, you have to add this service to the RegisterProviders slice, and the BootProviders slice.")])])}),[],!1,null,null,null);e.default=n.exports}}]);